# 2장 관계형 데이터베이스와 관계 연산 

## 관계형 데이터 모델 

- 데이터를 테이블 또는 릴레이션 구조로 표현하는 논리적 데이터 모델 

### 관계형 데이터 구조: 릴레이션 
- 데이터를 원자 값으로 갖는 이차원의 테이블: 릴레이션 
    - 논리적이므로 다양한 정렬 기준을 통해 릴레이션 표현 가능
    - 릴레이션 스키마: 릴레이션 구조
    - 릴레이션 인스턴스: 실제 값 
    - 릴레이션의 열: 속성
    - 릴레이션의 행: 튜플 
    - 하나의 속성이 취할 수 있는 같은 타입의 원자 값들의 집합: 도메인 

> 릴레이션 스키마  
릴레이션의 이름. 각 속성의 이름과 타입, 그리고 속성 값의 도메인을 정의하는 릴레이션에 데이터를 넣을 수 있도록 하는 릴레이션 틀  
릴레이션 스킴 또는 릴레이션 내포라고도 함  

> 릴레이션 인스턴스  
어느 시점의 릴레이션에 들어 있는 튜플들의 집합  
릴레이션 또는 릴레이션 외연이라고도 함  

> 속성  
<고객> 릴레이션에서 디그리는 4  
디그리 = 속성의 수 = 차수  

> 튜플 
<고객> 릴레이션에서 카디널리티는 4  
카디널리티 = 튜플의 수 = 기수 = 대응수  


### ER 모델을 관계형 데이터 모델로 변환 
- 개념적 데이터 모델(ER 모델) -> 논리적 데이터 모델(릴레이션 스키마)로 변환하는 것 (매핑 룰)
- 속성은 컬럼, 식별자는 기본키  
- 릴레이션 간의 관계는 기본키와 이를 참조하는 외래키를 이용해 표현  
- 예) 개체 A, B
    - 관계 Y, 1:1 관계인 경우: A의 기본키를 B의 외래키로 추가하거나 B의 기본키를 A의 외래키로 추가 
    - 관계 Y, 1:N 관계인 경우: A의 기본키를 B의 외래키로 추가  
    - 관계 Y, N:M 관계인 경우: A, B의 기본키를 모두 포함한 별도의 릴레이션으로 표현. 이때 생성된 별도의 릴레이션을 교차 릴레이션 또는 교차 엔티티라고 함 

> 식별 관계  
개체 A, B 사이의 관계에서 A의 기본키가 B의 외래키이면서 동시에 기본키가 되는 관계  
B의 존재 여부가 A 존재 여부에 의존적. 실선으로 표시  

> 비식별 관계  
개체 A, B의 관계에서 A의 기본키가 B의 비기본키 영역에서 외래키가 되는 관계  
B개체는 A의 존재 여부에 관계없이 존재  
일반적으로는 비식별이 많음. 점선으로 표시    

## 키의 개념 및 종류  

### 슈퍼키  
- 한 릴레이션 내에 있는 속성들의 집합으로 구성된 키  
- 릴레이션을 구성하는 모든 튜플에 대해 유일성은 만족하지만 최소성은 만족 x 
    - 예) <학생> 릴레이션에서 학번, 주민등록번호, (학번, 주민등록번호), (학번, 주민등록번호, 성명)  

### 후보키  
- 튜플을 유일하게 식별하기 위해 사용되는 속성들의 부분집합  
- 유일성, 최소성을 모두 만족   
    - 예) <학생> 릴레이션에서 학번이나 주민등록번호  
        - <수강> 릴레이션에서 (학번,과목명) 
        - (학번, 과목명) 처럼 두 개 이상 필드를 조합해 만든 키를 복합키라고 한다.  

> 유일성  
하나의 키 값으로 하나의 튜플만을 유일하게 식별할 수 있어야 함  

> 최소성  
키를 구성하는 속성 하나를 제거하면 유일하게 식별할 수 없도록 필요한 최소의 속성으로 구성되어야 함    
슈퍼키 중 유일성과 최소성을 만족하면 후보키가 된다.  

### 기본키  
- 후보키 중 특별히 중복된 값을 가질 수 없는 키  
- `NULL`일 수 없다.  
- 예) <학생> 릴레이션에서 학번, 주민번호 
    - <수강> 에서는 (학번, 과목명)을 조합해 사용  


### 대체키  
- 후보키 중 선정된 기본키를 제외한 나머지 후보키를 의미    
- 예) <학생> 릴레이션에서 학번이 기본키로 설정되면 주민번호가 대체키  

### 외래키  
- 다른 릴레이션의 기본키를 참조하는 속성 또는 속성들의 집합을 의미  
- 릴레이션 간 관계를 표현할 때 사용  
- 한 릴레이션에 속한 속성 A와 참조 릴레이션의 기본키인 B가 동일한 도메인상에 정의되면 속성 A를 외래키라 한다.  
- 외래키는 참조 릴레이션의 기본키와 동일한 키 속성을 가짐  

## 무결성 

### 무결성  

- 쉽게 말해 저장된 데이터베이스에 잘못된 데이터가 없다는 것을 의미 
- 저장된 데이터 값과 현실 세계의 값이 일체하는 정확성 
- **무결성 제약 조건**: 정확하지 않은 데이터가 데이터베이스 내에 저장되는 것을 방지하기 위한 제약 조건  

### 무결성의 종류  

- NULL 무결성: 릴레이션의 특정 속성 값이 NULL이 될 수 없도록 하는 규정 
- 고유 무결성: 릴레이션의 특정 속성에 대해 각 튜플이 갖는 속성값들이 서로 달라야한다는 규정  
- 도메인 무결성: 특정 속성의 값이 그 속성이 정의된 도메인에 속한 값이어야 한다는 규정  
- 키 무결성: 하나의 릴레이션에는 적어도 하나의 키가 존재해야 한다는 규정  
- 관계 무결성: 릴레이션에 어느 한 튜플의 삽입 가능 여부 또는 한 릴레이션과 다른 릴레이션의 튜플들 사이의 관계에 대한 적절성 여부를 지정한 규정  
- 참조 무결성: 외래키 값은 NULL 이거나 참조 릴레이션의 기본키 값과 동일해야 한다는 규정  
- 개체 무결성: 기본 릴레이션의 기본키를 구성하는 어떤 속성도 NULL일 순 없다.  

## 관계대수  

### 관계대수 개념 
- 관계형 데이터베이스에서 원하는 정보와 그 정보를 어떻게 유도하는가를 기술하는 절차적 언어  
- 하나 또는 두 개의 릴레이션을 입력으로 받아들여 결과로서 새로운 릴레이션을 생성해내는 연산들의 집합 
- `SELECT`, `PROJECT`, `JOIN`, `DIVISION`, 
- 집합 연산 
    - `UNION`
    - `DIFFERENCE`
    - `INTERSECTION`
    - `CARTESIAN PRODUCT`

### 순수 관계 연산자 
- `SELECT`
    - 릴레이션에 존재하는 튜플들 중 특정 조건을 만족하는 튜플들의 부분집합을 구해 새로운 릴레이션을 만듦
    - 행에 해당하는 튜플을 구해서 '수평연산' 이라고도 함  
    - 시그마 (σ) 기호 사용 
    - `σ(조건)R`
        - R은 릴레이션 
        - 조건에서는 `=, ≠, ≤, <, >, ≥` 등 기호 사용 
        - AND, OR, NOT 등의 논리 연산자 사용  

- `PROJECT`
    - 주어진 릴레이션에서 속성 리스트에 제시된 속성 값만을 추출해 새로운 릴레이션을 만듦 
    - 중복이 발생되면 중복 제거 
    - 열에 해당되는 속성을 추출하므로 수직 연산 
    - 파이 (𝜋) 기호 사용 
    - `𝜋(조건)(R)`
        - `𝜋(이름,국어)(성적)`
        - <성적> 릴레이션에서 이름, 국어 속성을 추출  

- `JOIN`
    - `JOIN` 결과로 만들어진 릴레이션의 차수는 조인된 두 릴레이션의 차수를 합한 것과 같음 
    - `⨝` 기호  
    - `R⨝(JOIN 조건)S`
    - `=, ≠, ≤, <, >, ≥` 연산자를 `θ`로 일반화하여 표현할 수도 있음 = 세타 조인 
    - `성적⨝(이름=이름)학적부`: 동일 조인  
    - JOIN 조건이 `=`이면 동일한 속성이 2번 나타남. 
    - 중복된 속성을 제거하는 것은 자연 조인  
        - `성적⨝학적부`

- `DIVISION`
    - 두 릴레이션 R(X), S(Y)에 대해 Y⊆X이고 X-Y=Z, R(X)와 R(Z,Y)는 동일한 표현  
    - 릴레이션 R(Z,Y)에 대한 S(Y)의 DIVISION 연산은 S(Y)의 모든 튜플에 연관되어 있는 R(Z)의 튜플을 선택하는 것  
    - `R[속성r÷속성s]S`
    - 속성r은 릴레이션R의 속성. 속성s는 릴레이션S의 속성 
    - 속성r과 속성s는 동일 속성 값을 가지는 속성이어야 함  

### 일반 집합 연산자  
- 집합 연산자 중 `UNION`, `DIFFERENCE`, `INTERSECTION`을 처리하려면 **합병 조건**을 만족해야함   

> 합병 조건  
합병하려는 두 릴레이션 간에 속성 수가 같고, 대응되는 속성별로 도메인이 같아야 함  

### 관계해석  
- 관계 데이터의 연산을 표현하는 방법  
- 원하는 정보가 무엇이라는 것만 정의하는 비절차적 특성 
- 튜플 관계해석, 도메인 관계해석 
- 질의어로 표현  
- 관계해석과 관계대수는 관계 데이터베이스를 처리하는 기능과 능력면에서 동일. 관계대수로 표현한 식은 관계해석으로 표현할 수 있다.  
