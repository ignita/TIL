# 정규화  

## 이상  

### 이상의 개념  
- 이상(Anomaly): 테이블에서 일부 속성들의 종속으로 인해 데이터의 중복이 발생하고, 이 중복으로 인해 테이블 조작 시 문제가 발생하는 현상  

### 이상의 종류  
- 삽입이상, 삭제이상, 갱신이상  

### 삽입 이상  
- 테이블에 데이터를 삽입할 때 의도와는 상관없이 원하지 않은 값들로 인해 삽입할 수 없게 되는 현상  

### 삭제 이상  
- 테이블에서 한 튜플을 삭제할 때 의도와는 상관없는 값들도 함께 삭제되는, 연쇄 삭제가 발생하는 현상 

### 갱신 이상  
- 테이블에서 튜플에 있는 속성 값을 갱신할 때 일부 튜플의 정보만 갱신되어 정보에 불일치성이 생기는 현상  

## 함수적 종속  

## 함수적 종속의 개념  
- 어떤 테이블 R. X 와 Y를 R의 속성 집합의 부분 집합이라 하면 
- 속성 X의 값 각각에 대해 시간에 관계 없이 항상 속성 Y의 값이 오직 하나만 연관되어 있으면 
- Y는 X 에 함수적 종속 또는 X가 Y를 함수적으로 결정한다고 한다. 
    - X → Y로 표기  
- 함수적 종속은 데이터의 의미를 표현한 것으로, 현실 세계를 표현하는 제약 조건이 되는 동시에 데이터베이스에서 항상 유지되어야 할 조건   

<학생> 테이블에서 함수적 종속 
- 학번 → 이름
- 학번 → 학년
- 학번 → 학과 
- 간단하게 학번 → 이름, 학년, 학과  
- 어떤 학생의 학번이 정해지면, 그 학번에 대응하는 이름, 학년, 학과의 값은 오직 하나만 존재한다. 이렇나 특성을 만족하는 학번은 <학생> 테이블의 기본키가 된다.  

- X → Y 의 관계를 갖는 속성 X와 Y에서 X를 결정자라하고 Y를 종속자라고 한다.  


### 함수적 종속 다이어그램 

- 한 테이블에 존재하는 속성들 간의 복잡한 함수적 종속 관계를 그림으로 표현할 수 있다. 그것이 **함수정 종속 다이어그램!**

- 학번, 과목 → 성적
- 학번 → 학년  

&nbsp;  
&nbsp;  
&nbsp;  
&nbsp;&nbsp;   
&nbsp;  
&nbsp;  
&nbsp;  
&nbsp;&nbsp;  

- 성적은 완전 함수적 종속
- 학년은 부분 함수적 종속 

- 완전 함수적 종속 
    - 기본키에 대해 완전히 종속적일 때   


## 정규화  

### 정규화의 개념 
- 테이블의 속성들이 상호 종속적인 관계를 갖는 특성을 이용해, 테이블을 무손실 분해하는 과정  
- 무손실 분해: 테이블 R의 프로젝션(특정 테이블에서 일부 속성들만 추출해서 만든 테이블)인 R1, R2가 자연 조인을 통해 원래의 테이블 R로 정보 손실 없이 복귀되는 경우 R은 R1 R2로 무손실 분해되었다고 한다.  
- 정규화의 목적 
    - 가능한 한 중복을 제거해 삽입, 삭제, 갱신 이상의 발생 가능성을 줄이는 것!! !
- 정규형 
    - 제 1정규형
    - 제 2정규형
    - 제 3정규형
    - BCNF
    - 제 4정규형 
    - 제 5정규형  
    - 순서대로 정규화 정도가 높아짐  

### 정규화 과정  

| 제품번호 | 제품명 | 재고수량 |    주문번호    |   고객번호  |      주소      |   주문수량  |
|:--------:|:------:|:--------:|:--------------:|:-----------:|:--------------:|:-----------:|
|   1001   | 모니터 |   2000   |    A345 D347   |   100 200   |    서울 부산   |   150 300   |
|   1007   | 마우스 |   9000   | A210 A345 B230 | 300 100 200 | 광주 서울 부산 | 600 400 700 |
|   1201   | 키보드 |   2100   |      D347      |     200     |      부산      |     300     |

- 제 1정규형 
    -  테이블에 속한 모든 속성의 도메인이 원자 값으로만 되어 있는 정규형 
    - <주문목록> 테이블에서는 하나의 제품에 대해 여러 개의 주문 관련 정보가 발생하고 있다. 그래서 제 1정규형이 아님 
    - 정규화 테이블 

**<제품>**
| 제품번호 | 제품명 | 제고수량 |
|:--------:|:------:|:--------:|
|   1001   | 모니터 |   2000   |
|   1007   | 마우스 |   9000   |
|   1201   | 키보드 |   2100   |

**<제품주문>**
| 주문번호 | 제품번호 | 고객번호 | 주소 | 주문수량 |
|:--------:|:--------:|:--------:|:----:|:--------:|
|   A345   |   1001   |    100   | 서울 |    150   |
|   D347   |   1001   |    200   | 부산 |    300   |
|   A210   |   1007   |    300   | 광주 |    600   |
|   A345   |   1007   |    100   | 서울 |    400   |
|   B230   |   1007   |    200   | 부산 |    700   |
|   D347   |   1201   |    200   | 부산 |    300   |

- 제 2정규형 
    - 테이블이 제 1정규형이고, 기본키가 아닌 모든 속성이 기본키에 대해 완전 함수적 종속을 만족하는 정규형  
    - <주문목록> 테이블이 <제품> 테이블, <제품주문> 테이블로 무손실 분해되어서 모두 제 1정규형이 되었지만 <제품주문> 테이블은 기본키인 (주문번호, 제품번호)에 완전 함수적 종속이 되지 않는 속성이 존재 
        - 고객번호와 주소는 주문번호에 의해서도 결정될 수 있음  

- 제 3정규형 
    - 테이블이 제 2정규형이고 기본키가 아닌 모든 속성이 기본키에 대해 이행적 함수적 종속을 만족하지 않는 정규형 
    - 이행적 함수적 종속 
        - A → B이고 B → C일 때 A → C를 만족하는 관계   

- BCNF
    - 테이블에서 모든 결정자가 후보키인 정규형  
- 제 4정규형 
    - 다중 값 종속 A → B가 존재할 경우 모든 속성이 A에 함수적 종속 관계를 만족하는 정규형 
    - 다중 값 종속 
        - A, B, C 3개의 속성을 가진 테이블에서 어떤 복합속성(A, C)에 대응하는 B의 값의 집합이 A값에만 종속되고 C값에 무관하면 B는 A에 다중 값 종속이라 하고 A ↠ B로 표기 
- 제 5정규형 
    - 테이블의 모든 조인 종속이 후보키를 통해서만 성립되는 정규형 
    - 조인 종속 
        - 어떤 테이블의 속성에 대한 부분집합에서 만일 테이블이 자신의 프로젝션 X, Y, ..., Z 를 모두 조인한 결과와 동일한 경우 테이블은 조인종속을 만족한다고 한다.  
- 역정규화 
    - 정규화로 인해 여러 개로 분해된 릴레이션들에서 원하는 정보를 얻기 위해선 조인을 사용해 다시 연결해야 하는데, 지나치게 자주 조인을 사용하면 응답 속도가 떨어지므로 정규화에 위배되지만 성능 향상을 위해 다시 테이블을 합쳐야 한다. 이것을 역정규화라 한다.   


정규화라는 출소자가 말했다.  
**두부이겨다줘 ≒ 도부이결다조**
- **도**메인이 원자값
- **부**분적 함수 종속 제거
- **이**행적 함수 종속 제거 
- **결**정자이면서 후보 키가 아닌 것 제거 
- **다**치 종속 제거
- **조**인 종속성 이용  

