# 리다이렉션  

- 입출력 방향 지정(I/O 리다이렉션)  
 - I/O: 입력/출력  
 - 명령은 리다이렉션을 통해 파일로부터 입력받을 수 있고, 또한 파일로 출력이 가능하다.  
 - 강력한 명령어 파이프라인을 만들기 위해 필요한 명령어들을 연결할 수 있다.  

- `cat` - 파일 연결하기  
- `sort` - 텍스트 라인 정렬하기  
- `uniq` - 중복 줄을 알리거나 생략하기  
- `wc` - 각 파일의 개행 및 단어 개수, 파일 바이트 출력하기  
- `grep` - 패턴과 일치하는 라인 출력하기  
- `head` - 파일의 첫 부분 출력하기  
- `tail` - 파일의 마지막 부분 출력하기  
- `tee` - 표준 입력을 읽고 표준 출력 및 파일에 쓰기  

## 표준 입출력과 표준 오류  

- 프로그램이 만들어내는 출력의 형식  
 - 프로그램의 결과 - 프로그램이 출력하도록 설계한 데이터  
 - 상태 및 오류 메시지 - 프로그램이 어떻게 돌아가고 있는지를 말해줌  
- "모든 것은 파일이다"라는 유닉스의 정신  
 - `ls`와 같은 프로그램  
   - **표준 출력(stdout)**라고 불리는 특수한 파일에 명령어에 대한 결과를 보냄  
    - **표준 오류(stderr)**라는 또 다른 파일에 상태 메시지를 전송    
    - 기본적으로 표준 출력과 오류는 모두 화면에 연결되어 있고 따로 디스크 파일에 저장 x   
 - 또한 많은 프로그램들이 **표준 입력(stdin)**이라고 부르는 곳에서 입력 내용을 가져오고 키보드와 연결되어 있다.  
 - 입출력 방향 지정(I/O 리다이렉션) 기능으로 출력과 입력의 방향 변경이 가능  
   - 일반적으로 출력은 화면에, 입력은 키보드로부터 인식되지만 이 기능으로 방식 변경이 가능   

### 표준 출력 재지정  
- `>` 리다이렉션 연산자 - 화면에 출력하는 대신 다른 파일에 출력되도록 지정  
 - 왜 이런 일을 하는가?  
   - 명령어 출력결과를 파일에 저장하는 것이 종종 유용하기 때문  
    - 예) ls 명령어의 결과를 화면 대신 ls-output.txt 파일에 보내기  
```
[me@linuxbox ~]$ ls -l /usr/bin > ls-output.txt
```
- 존재하지 않는 디렉토리를 사용하면?  
 - 예)
 ```
 [me@linuxbox ~]$ ls -l /bin/usr > ls-output.txt
 ls: cannot access /bin/usr: No such file or directory
 ```  
 - 왜 오류 메시지는 ls-output.txt가 아닌 화면에 표시되었을까?  
   - **ls 오류 메시지를 표준 출력으로 전송하지 않고 표준 오류로 전송하기 때문!**   
 - 위와 같이 입력하면 파일 크기가 0이 된다. 왜냐하면 > 리다이렉션 연산자로 출력 방향을 지정하면 목적 파일은 항상 처음부터 다시 작성되기 때문이다. 그래서 언제든지 파일을 잘라낼 필요가 있거나 새로운 빈 파일을 만들 때 다음 트릭을 사용할 수 있다.  
  ```
  [me@linuxbox ~]$ > ls-output.txt
  ```  
- 파일 이어쓰기  
 - >> 리다이렉션 연산자 사용  
 ```
 [me@linuxbox ~]$ ls -l /usr/bin >> ls-output.txt
 ```  
 - 존재하지 않는 파일이면 > 연산자를 사용한 것처럼 파일이 생성된다.  

### 표준 오류 재지정  

- 리다이렉션 연산자 말고 **파일 디스크립터**를 참조  
- 프로그램은 번호로 지정된 파일 스트림 중에 어디에라도 출력을 할 수 있다.  
- 쉘은 내부적으로 표준 입출력과 표준 오류를 0, 1, 2번 파일 디스크립터로 표현  
- 표준 오류는 파일 디스크립터 2와 같기 때문에 다음과 같이 재지정할 수 있다.  
 ```
 [me@linuxbox ~]$ ls -l /bin/usr 2> ls-error.txt
 ```

### 표준 출력과 표준 오류를 한 파일로 재지정  

- 쉘의 예전 버전  
```
[me@linuxbox ~]$ ls -l /bin/usr > ls-output.txt 2>&1
```  
 - 먼저 표준 출력이 ls-output.txt 파일로 재지정  
 - 2&1의 입력으로 파일 디스크립터 2(표준 오류)가 파일 디스크립터 1(표준 출력)로 재지정되도록 한다.  
 - 순서가 중요!  
- bash의 최신 버전  
 ```
 [me@linuxbox ~]$ ls -l /bin/usr &> ls-output.txt
 ```  

### 원치 않는 출력 제거  
- 명령어의 출력 결과를 원하지 않고 단지 버리고 싶다면,  
 - 시스템은 /dev/null이라는 특수 파일로 출력 방향을 지정함으로써 문제의 해결 방법을 제공  
 - 이 파일은 **비트 버킷**(bit bucket)이라고 불리는 시스템 장치로 입력을 받고 아무것도 수행하지 않는다.  
 - 오류 메시지를 숨기기 위한 방법  
 ```
 [me@linuxbox ~]$ ls -l /bin/usr 2> /dev/null
 ```  

### 표준 입력 재지정  

#### cat - 파일 붙이기  
- 하나 이상의 파일을 읽어 들여서 표준 출력으로 그 내용을 복사  
```
cat [file...]  
```
- 여러 파일을 한 파일로 연결  
```
[me@linuxbox ~]$ cat movie.mpeg.0* > movie.mpeg
```  

- cat 명령어 후에 아무런 인자를 입력하지 않으면 표준 입력으로부터 데이터를 읽는다. 그리고 키보드로 연결되있기 때문에 무엇인가 입력되기를 기다린다.  
- 입력하고 난 후 <kbd>CTRL</kbd>-<kbd>D</kbd>를 입력하면 표준 입력에 EOF문자(파일의 끝을 나타내는)가 입력된다.  
- 파일명 위치에 아무것도 입력하지 않았기 때문에 cat은 표준 입력을 표준 출력 위치에 복사  
- 텍스트가 반복된다.  


## 파이프라인  
- 표준 입력으로부터 데이터를 읽고, 표준 출력으로 데이터를 전송하는 명령어의 능력은 **파이프라인**이라고 하는 쉘의 기능으로 더 응용 가능  
- |(수직 바) 기호를 사용해 명령어의 표준 출력을 또 다른 명령어의 표준 입력과 연결 가능  
- 예)  
```
[me@linuxbox ~]$ ls -l /usr/bin | less
```    

### 필터  
- 하나의 파이프라인에 여러 명령어를 입력하는 방식을 사용하는 명령어들을 필터라 일컫는다.  
- sort 명령어  
```
[me@linuxbox ~]$ ls /bin /usr/bin | sort | less
```   
- 정렬된 두 목록을 ls의 결과로 가져올 것이다.  

### uniq - 중복줄 제거 및 표시  
- 표준 입력이나 하나의 파일명 인자로부터 정렬된 데이터 목록을 입력받아서 중복된 내용을 제거해줌  
```
[me@linuxbox ~]$ ls /bin /usr/bin | sort | uniq | less
```  
- 반대로 중복된 내용이 보고 싶으면 -d 옵션을 사용하면 된다.  

### wc - 라인, 단어 개수 및 파일 크기 출력  
- wc(word count: 단어 개수 세기) 명령어는 파일에 들어있는 단어 및 라인의 개수와 파일 크기를 표시  
```
[me@linuxbox ~]$ wc ls-output.txt
```  
- -l 옵션은 라인 수만 보고 싶을 때 사용  

### grep - 패턴과 일치하는 라인 출력  
- grep은 파일 내에서 "패턴"을 만나을 때, 그 패턴을 가지고 있는 라인을 출력  
```
[me@linuxbox ~]$ ls /bin /usr/bin | sort | uniq | grep zip
```  
- -i 옵션은 검색을 수행할 때 대소문자 구분 x  
- -v 옵션은 패턴과 일치하지 않는 라인만 출력  

### head/tail - 파일의 처음/끝 부분 출력  

- -n 옵션으로 길이 조절 가능  
```
[me@linuxbox ~]$ head -n 5 ls-output.txt
```  
- -f 옵션으로 지속적으로 로그 파일을 감시하고 새 내용이 추가될 때 곧바로 그 내용을 표시, <kbd>CTRL</kbd>-<kbd>C</kbd> 입력할 때까지 계속  

### tee - 표준 입력에서 데이터를 읽고, 표준 출력과 파일에 출력  
- 작업이 진행되고 있을 때, 중간 지점의 파이프라인에 있는 내용을 알고 싶을 때 유용  
- 파이프라인 내용에 grep 필터가 적용되기 전 디렉토리의 목록 전부를 ls.txt 파일에 저장하기  
```
[me@linuxbox ~]$ ls /usr/bin | tee ls.txt | grep zip
```