# VI  

## vi를 왜 배워야 할까????

- vi는 어디에서나 사용 가능하다. 원격 서버나 X의 환경설정이 망가진 로컬 시스템처럼 그래픽 환경이 지원되지 않는 시스템을 접하게 됐을 때, 유닉스 시스템상의 프로그램 호환성 표준인 POSIZ는 vi를 필요로 한다.  
- vi는 가볍고 빠르다. 많은 작업을 할 때, vi 편집기를 불러오는 것은 수월. 게다가 vi는 입력 속도를 중요시 설계되었기 때문에 편집하는 동안 마우스를 사용하지 않는다.  
- 우리는 다른 리눅스나 유닉스 사용자에게 뒤쳐지고 싶지 않다!??  


## VI의 역사  

- vi의 첫 번째 버전은 1976년에 빌 조이(Bill Joy)가 만들었다.  
 - 미국 UC 버클리 학생이었는데, 나중에 선 마이크로시스템즈의 공동 창업자가 되었다.  
- vi란 이름은 visual(보이는 것)이란 단어에서 따온 것인데, 그 이유는 원래 이 편집기는 커서로 비디오 터미널상에서 편집하는 것이 가능하도록 만들어진 것이기 때문이다.  
- visual 편집기 이전에는 **라인 편집기**가 있었다.  
  - 한 번에 한 줄씩만 처리가 가능하다.    
- 대부분의 리눅스 배포판에는 진짜 vi가 없다. 대신 브람 무어나르(Bram Moolenaar)가 만든 vim(Vi IMproved의 약자)이라고 하는 vi 확장판이 있다.  
 - vim은 전통적인 유닉스의 vi 이상의 상당한 개선이 이뤄진 버전. 대개 리눅스 시스템에서는 vi라는 이름으로 심볼릭 링크(또는 별칭)되어 사용된다.  
  

## vi 시작과 종료 

- vi를 시작하렴녀 다음과 같이 간단하게 입력하면 된다.  
```
[me@linuxbox ~]$ vi
```

- vi가 시작되면 다음 화면이 보인다.  
```
~                                                                               
~                                                                               
~                                                                               
~                                                                               
~                                                                               
~                              VIM - Vi IMproved                                
~                                                                               
~                                 version 7.3                                   
~                           by Bram Moolenaar et al.                            
~                 Vim is open source and freely distributable                   
~                                                                               
~                        Help poor children in Uganda!                          
~                type  :help iccf<Enter>       for information                  
~                                                                               
~                type  :q<Enter>               to exit                          
~                type  :help<Enter>  or  <F1>  for on-line help                 
~                type  :help version7<Enter>   for version info                 
~                                                                               
~                                                                               
~                                                                               
~                                                                               
~  
```  

- 종료는 다음 명령어를 입력한다. 그럼 다시 쉘 프롬프트가 나타난다. 
```
:q
```
- 어떤 이유에서든 vi가 종료되지 않으면(보통 파일을 저장하지 않았을 경우가 원인) 느낌표를 추가해 강제 종료 가능하다.  
```
:q!
```  

## 편집 모드  
- 존재하지 않는 파일의 이름을 입력하는 것은 vi로 새 파일을 만드는 방법이다.  
```
[me@linuxbox ~]$ rm -f foo.txt  
[me@linuxbox ~]$ vi foo.txt
```
- vi 앞에 나오는 ~ 기호들은 해당 줄에 아무런 텍스트가 없다는 것을 나타낸다. 즉 파일이 비었다는 뜻이다.  
- vi는 **모달 편집기**(modal editor)이기 때문에 vi가 실행되면 **명령어 모드**로 시작된다.  
 - 이 모드에서는 대부분의 모든 키가 명령어를 의미하기 때문에 타이핑하면 모든 것을 엉망으로 만들 수도 있다.  

### 텍스트 입력 모드로 들어가기  

- 입력 모드로 들어가기 위해서는 I 키(i)를 입력한다. vim이 확장 모드에서 실행되고 있다면 화면 하단에 다음과 같이 보여야한다.  
```
-- INSERT --
```

- 다음과 같은 텍스트를 입력하고 입력 모드를 종료하고 명령 모드로 돌아가려면 <kbd>ESC</kbd> 키를 입력하면 된다.  
```
The quick brown fox jumped over the lazy dog.
```
 
### 저장하기  

파일에 변경된 사항을 저장하려면 반드시 ex 명령어 모드에서 입력해야 한다.  
- : 키를 입력해 저장하려면 콜론 다음에 w 문자를 입력하고 엔터를 누른다.  
- 파일은 하드 드라이브에 저장이 되고, 다음과 같은 확인 메시지가 화면 아래쪽에 나타난다.  
```
"foo.txt" [New] 1L, 46C written  
```

## 커서 이동  

| 키 | 커서 이동 방향 |  
| --- | --- |
| L 또는 오른쪽 방향키 | 오른쪽 한 문자 | 
| H 또는 왼쪽 방향키 | 왼쪽 한 문자 |  
| J 또는 아래쪽 방향키 | 한 줄 아래로 | 
| K 또는 위쪽 방향키 | 한 줄 위로 |  
| 0 (zero) | 현재 줄 처음으로 |  
| SHIFT-6(^) | 현재 줄 첫 번째 공백이 아닌 글자로 |
| SHIFT-4($) | 현재 줄 마지막으로 |  
| W | 다음 단어나 구두점 기호 처음으로 |  
| SHIFT-W(W) | 다음 단어 처음으로, 구두점 기호 무시 | 
| B | 이전 단어나 구두점 기호 처음으로 |  
| SHIFT-B(B) | 이전 단어 처음으로, 구두점 기호 무시 |  
| CTRL-F 또는 PAGE DOWN | 한 페이지 아래로 |  
| CTRL-B 또는 PAGE UP | 한 페이지 위로 | 
| number-SHIFT-G | 줄 번호로 이동(1G를 입력하면 파일의 첫 번째 줄로 이동)  
| SHIFT-G(G) | 파일의 마지막 줄로 |  

## 기본 편집  

### 텍스트 덧붙이기   

- 문장의 맨 끝으로 커서를 이동하고 A를 입력하면 커서는 그 줄 끝을 지나 추가된다.  

### 빈줄 추가  

- 텍스트를 입력할 수 있는 다른 방법으로는 줄을 "띄우는" 것이다.  
- 즉 기존의 두 줄 사이를 띄워서 입력 모드로 들어가는 것.  

 | 명령어 | 실행 |  
 | --- | --- | 
 | o | 현재 줄 아래에 빈 줄 추가 |
 | O | 현재 줄 위에 빈 줄 추가 |  
 
- u를 입력해서 방금한 작업의 취소도 가능하다.  

### 텍스트 삭제  

- 텍스트 삭제 명령어  

 | 명령어 | 삭제 내용 |  
 | --- | --- |  
 | x | 현재 문자 | 
 | 3x | 현재 문자를 포함한 다음 2개 문자 |
 | dd | 현재 줄 | 
 | 5dd | 현재 줄을 포함한 다음 4줄 |  
 | dw | 현재 커서 위치부터 다음 단어 앞까지 | 
 | d$ | 현재 커서 위치부터 현재 줄 끝까지 |  
 | d0 | 현재 커서 위치부터 현재 줄 맨 앞까지 | 
 | d^ | 현재 커서 위치부터 그 줄의 공백이 아닌 첫 번째 글자까지 | 
 | dG | 현재 줄부터 그 파일 끝까지 | 
 | d20G | 현재 줄부터 파일의 20번째 줄까지 |  

### 텍스트 자르기, 복사하기 그리고 붙이기  

- d 명령어가 단순히 텍스트 삭제 뿐만 아니라 텍스트 "자르기"도 수행  
- d 명령어를 사용할 때마다 삭제된 내용은 붙이기 버퍼(클립보드를 생각하면 된다)에 복사되 p 명령어로 그 내용을 다시 불러와서 커서 앞 또는 뒤로 붙이기를 수행  
- y 명령어도 d 명령어와 매우 비슷한 방법으로 텍스트를 자르고 "복사"하는 기능을 수행  
- 복사 명령어  
 
 | 명령어 | 복사 내용 |  
 | --- | --- |
 | yy | 현재 줄 |  
 | 5yy | 현재 줄을 포함한 다음 4줄 |  
 | yW | 현재 커서 위치부터 다음 단어 앞까지 | 
 | y$ | 현재 커서 위치부터 현재 줄 끝까지 | 
 | y0 | 현재 커서 위치부터 현재 줄 맨 앞까지 | 
 | y^ | 현재 커서 위치부터 그 줄의 공백이 아닌 첫 번째 글자까지 | 
 | yG | 현재 줄부터 그 파일 끝까지 | 
 | y20G | 현재 줄부터 파일의 20번째 줄까지 |  

- p와 P의 차이 - p는 커서 앞 P는 커서 뒤에 붙여넣기  

### 줄 합치기  

- J 명령어를 사용  

## 검색 및 치환  

### 줄에서 텍스트 검색  

- f 명령어는 줄을 검색해 찾으려는 문자 위치로 커서를 이동  
- fa는 현재 줄에 있는 a문자를 찾아 이동  

### 파일에서 텍스트 검색  

- 단어나 문장에서 검색된 위치로 커서를 이동하기 위해 / 명령어가 사용됨  
- / 명령어 입력 시, 슬래시가 화면 아래쪽에 나타남  
 - 그 후 검색하려는 단어나 문장을 입력하고 엔터키를 누르면 커서가 이동된다.  
 - n 명령어를 사용하면 이전 검색어로 검색을 반복해준다.  

### 전체 검색 및 치환  

- vi는 ex 명령어를 사용해 해당 줄이나 파일 전체에서 검색할 내용을 찾아서 바꾸기 작업(vi에서는 치환으로 불림)을 수행한다.   
- 파일 전체에서 Line을 line으로 바꾸기 위해 다음과 같은 명령어를 입력해야 한다.  
```
:%s/Line/line/g  
```

  | 항목 | 뜻 |  
  | --- | --- | 
  | : | 콜론 문자는 ex 명령어를 실행한다. |  
  | % | 작업을 수행할 줄 범위를 보여주고 있다. % 기호의 의미는 첫 번째 줄부터 마지막 줄이라는 의미. 그렇지않으면 1, 5와 같이 범위 지정 가능, 1, $를 입력하면 "1번 줄부터 파일의 끝까지", 줄 범위 지정안하면 현재 라인에만 |  
  | s | 작업을 지정한다. 이 경우에는 치환 작업 |  
  | /Line/line/ | 검색 패턴과 바꾸고자 하는 텍스트를 입력 |  
  | g | 전체를 의미. 치환 작업은 매 줄마다 검색 문자열 하나씩 싦행되는데, g를 사용하지 않으면 각 줄마다 첫 번째 검색 문자열만 변경 |  


- 사용자 확인 메시지를 표시하려면 명령 끝에 "c"만 붙이면 된다.  
```
:%s/line/Line/gc 
```
```
replace with Line (y/n/a/q/l/^E/^Y)?  
```
 - 치환 명령 확인 메시지 키  

  | 키 | 실행 |  
  | --- | --- | 
  | y | 치환 실행 |  
  | n | 이번 치환 건너뛰기 |  
  | a | 전체 치환 실행 | 
  | q or ESC | 치환 중단 | 
  | l | 이번 치환 후 종료(last) | 
  | CTRL-E, CTRL-Y | 스크롤 위 아래로 이동하기. 치환 내용을 확인할 때 유용 |  

## 다중 파일 편집  

```
vi file1 file2 file3...
```

- vi를 실행하면 첫 번째 파일이 화면에 나타난다.  

### 파일 간 전환  

- 현재 파일을 다음 파일로 전환하려면, ex 명령어 사용  
```
:n
```
- 이전 파일로 되돌아가려면 다음과 같이 입력  
```
:N
```  
- vi는 다른 파일로 전환할 때, 현재 파일이 저장되지 않으면 파일을 전환할 수 없도록 하고 있다. 강제로 파일을 전환하고 변경 사항을 저장하지 않으려면 명령어에 느낌표(!)를 붙이면 된다.  
- :buffers 명령어로 수정 중인 파일 목록을 볼 수 있다.  
```
:buffers
  1 %a + "foo.txt"                      line 28
  2      "ls-output.txt"                line 0
Press ENTER or type command to continue
```
- 여기서 다른 버퍼(파일)로 전환하려면 :buffer 명령어 다음에 수정하려는 버퍼 번호를 입력하면 된다.  
```
:buffer 2
```  

### 다른 파일 열어서 편집  

- ex 명령어인 :e(edit의 준말) 다음에 파일명을 입력해 다른 파일을 열 수 있다.  
- :e 명령어로 로드된 파일들은 전환이 불가능. 파일을 전환하려면 :buffer 명령어 다음에 버퍼 번호를 입력  

### 파일 내용을 다른 파일로 복사  

- :buffer 1명령을 이용해 yy로 복사하고 buffer 2로 다음 파일로 이동해 p 명령으로 붙인다.  

### 파일 전체를 다른 파일에 삽입  

- 다음과 같은 ex 명령어 입력  
```
:r foo.txt
```
- :r 명령어(read의 준말)는 지정한 파일을 커서 위치 바로 앞에 삽입.  

## 저장하기  

- ex 명령어 - :w, 파일명 지정도 가능   
- 명령어 모드 - ZZ(저장하고 종료)  
- 파일은 새 이름으로 저장도지만 편집 중인 현재 파일명은 변경되지 않는다.

