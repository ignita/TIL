# 기타 네트워크 계층 프로토콜  
- IP 프로토콜 = 응용 계층에서 생성된 사용자 데이터를 전송하기 위해 사용된다.  
- 인터넷 환경에서 데이터 전송이 올바르게 이루어지려면 전송 프로토콜 외 다양한 제어 프로토콜이 필요함.  
- 제어프로토콜  
  - ICMP: 데이터 전송 과정에서 오류를 제어  
  - ARP/RARP: IP주소와 MAC주소 사이의 변환을 담당  

## ARP(Address Resolution Protocol)
- 네트워크 환경에서 임의의 호스트가 다른 호스트에 데이터를 전송하려면 수신 호스트의 IP 주소 뿐만 아니라 MAC 주소도 알아야 한다.  
- 수신 호스트의 IP 주소는 보통 응용 프로그램 사용자가 프로그램을 실행하는 과정에서 직접 입력하므로, IP 주소로부터 수신 호스트 MAC 주소를 얻는 작업이 추가로 필요  

### MAC 주소   
![ARP의 필요성](http://dbscthumb.phinf.naver.net/3578_000_1/20141023224401228_989KZEJ5A.jpg/ka8_118_i1.jpg?type=w627_fst_n&wm=Y)  
- IP 프로토콜 헤더에서 필요한 송신 호스트 IP 주소, 수신 호스트 IP 주소와 함께 MAC 계층에서도 송신 호스트 MAC 주소, 수신 호스트 MAC 주소가 필요.  
  - 송신 호스트 IP 주소는 자신의 하드 디스크에, 수신 호스트의 IP 주소는 사용자가 접속하고자 하는 호스트의 IP 주소를 지정  
  - 사용자는 일반적으로 도메인 이름을 입력하는데 이 도메인 이름이 DNS 서비스를 통해 IP 주소로 쉽게 변환 가능  
- MAC 주소의 경우 송신 호스트 MAC 주소는 자신의 LAN 카드에 내장  
- 수신 호스트의 MAC 주소는 수신 호스트의 IP 주소를 매개변수로 해 ARP 기능을 통해 얻어야 한다.  
- 예) 호스트 A가 호스트 B의 MAC 주소를 얻으려면 ARP request라는 특수 패킷을 브로드캐스팅해야 함.  
  - ARP request 패킷은 네트워크의 모든 호스트가 수신하지만 관계없는 호스트는 패킷을 무시하고 호스트 B만 IP 주소가 자신의 IP 주소와 동일함을 인지.  
  - 따라서 호스트 B는 ARP reply 패킷을 사용해 자신의 MAC 주소를 호스트 A에 회신  
- 데이터 전송시마다 ARP를 사용해 패킷을 브로드캐스팅하게 되면 네트워크 트래픽이 증가  
  - 따라서 ARP를 사용하는 호스트에선 가장 최근에 얻은 IP 주소와 MAC 주소 매핑 값을 보관하는 캐시 정보를 이용  
  - 또 송신 호스트가 ARP request 패킷을 브로드캐스팅하는 과정에서 패킷을 수신한 모든 호스트는 송신 호스트의 IP 주소와 MAC 주소 매핑 값을 자동으로 얻을 수 있음.  
  - → ARP 트래픽에 의한 네트워크 부하를 최소화  

## RARP(Reverse Address Resolution Protocol)
![RARP의 필요성](http://dbscthumb.phinf.naver.net/3578_000_1/20141023224401459_HWTX4NB5F.jpg/ka8_118_i2.jpg?type=w627_fst_n&wm=Y)  
- ARP와 반대로 MAC 주소를 이용해 IP 주소를 제공  
- 디스크가 존재하지 않는 시스템이나 X윈도우 터미널 등에서는 자신의 LAN 카드 정보를 읽어 MAC 주소를 얻을 수 있지만, 파일 시스템이 없으므로 IP 주소를 보관할 방법이 없다.  
  - 이 경우 자신의 MAC 주소와 IP 주소의 매핑 값을 보관하는 호스트로부터 IP 주소를 얻어야함.  
- IP를 얻고자 하는 호스트에서는 MAC 주소를 매개변수로 해 패킷을 브로드캐스팅한다.  
  - 보통 네트워크에는 RARP 기능을 전담으로 수행하는 서버가 하나 이상 존재  
  - 따라서 모든 호스트가 RARP 변환 요청을 받아도 해당 정보를 보관하고 있는 RARP 서버만 응답을 수행  
- IP 주소를 얻은 후 미리 정해진 호스트로부터 자신의 부트 이미지(시스템 운영체제)를 다운로드  
  - 따라서 이러한 시스템은 ROM 등의 비활성 메모리에 다른 호스트와 통신하여 필요한 부트 이미지를 수신할 수 있는 TFTP 등의 기본 프로토콜이 존재  

## ICMP(Internet Control Message Protocol)  
- 인터넷 환경에서 오류에 관한 처리를 지원하는 용도  
- IP 패킷의 데이터 부분에 캡슐화되 송신 호스트에게 전달  
- TCP/IP 기반의 통신망에서 전송 과정에 문제 발생 시 → 라우터에 의해 ICMP 메시지가 자동으로 발생해 패킷 송신 호스트에게 전달  

### ICMP 메시지  
- ICMP에 의해 발생되는 주요 메시지(프로토콜 헤더의 Type 필드 값에 따라 구분)  
  - ECHO REQUEST, ECHO REPlY: 유닉스의 ping 프로그램에서 네트워크의 신뢰성을 검증하기 위해 ECHO REQUEST 메시지를 전송하고, 이를 수신한 호스트에서는 ECHO REPLY를 전송해 응답  
  - DESTINATION UNREACHABLE: 수신 호스트가 존재하지 않거나, 존재해도 필요한 프로토콜이나 포트 번호 등이 없어 수신 호스트에 접근이 불가능한 경우에 발생  
  - SOURCE QUENCH: 네트워크에 필요한 자원이 부족해 패킷이 버려지는 경우에 발생. 예를 들면, 전송 경로에 있는 라우터에 부하가 많이 걸려 패킷이 버려지는 경우. 이 메시지를 이용해 송신 호스트에게 혼잡 가능성을 경고, 패킷 송신 호스트가 데이터를 천천히 전송하도록 알릴 수 있음  
  - TIME EXCEEDED: 패킷의 TTL(Time To Live) 필드 값이 0이 되어 패킷이 버려진 경우에 주로 발생. 기타의 시간 초과 현상에 의해 패킷이 버려진 경우도 이에 해당  
  - TIMESTAMP REQUEST, TIMESTAMP REPLY: 두 호스트 간의 네트워크 지연을 계산하는 용도로 사용  
  
### ICMP 헤더 형식  
![ICMP 헤더](http://dbscthumb.phinf.naver.net/3578_000_1/20141023224401682_M0ZT1812I.jpg/ka8_119_i1.jpg?type=w575_fst_n&wm=Y)  
- 그림과 같이 ICMP 메시지 첫 줄의 4바이트는 모든 메시지에서 동일. 이어지는 메시지 내용은 가변적  
- 단 4바이트의 내용1을 포함해 총 8바이트의 ICMP 정보는 반드시 포함  
- ICMP 메시지 내용 1은 DESTINATION UNREACHABLE, SOURCE QUENCH, TIME EXCEEDED 등에서는 사용되지 않으므로 0이 채워지지만, ECHO REQUEST, ECHO REPLY, TIMESTAMP REQUEST, TIMESTAMP REPLY 같은 메시지에서는 특정 값이 주어짐  
- 1바이트의 Type 필드는 메시지를 구별  
- Code 필드는 메시지 내용에 대한 더 자세한 정보  
- Checksum 필드는 ICMP 전체 메시지에 대한 체크섬 기능을 지원  
- ICMP의 주요 임무는 전송 오류 보고  
  - 오류 메시지 전송의 경우 메시지 내용 2에는 오류 원인을 제공한 IP 패킷의 헤더와 이어지는 8바이트의 정보가 포함  
**- ICMP의 주요 임무는 전송 오류 보고**   


### ICMP 메시지의 전송  
![ICMP 메시지의 전송](http://dbscthumb.phinf.naver.net/3578_000_1/20141023224401730_46KVSQVBY.jpg/ka8_119_i2.jpg?type=w530_fst_n&wm=Y)  
- 기능적으로 IP 프로토콜과 같은 계층의 역할을 수행  
- 데이터 링크 계층에 바로 전달 x, IP 패킷에 캡슐화된 후에 전달  

## IGMP(Internet Group Management Protocol)  
- 임의의 호스트가 멀티캐스트 그룹에 가입하거나 탈퇴할 때 사용하는 프로토콜  
- 호스트와 라우터 사이에 그룹 멤버 정보를 교환하는 용도  
- `멀티캐스트: 특정 그룹에 속하는 모든 호스트에게 메시지를 전송하는 방식`  


## 요약  
1. 새로운 IP 프로토콜인 IPv6는 기존의 32비트 주소은 IPv4에서 확장된 128비트 주소를 지원하며, 헤더 구조를 단순화하고 흐름 제어 기능이 강화되었다.  
2. IPv6 주소의 형식은 FFFF:FFFF:FFFF:FFFF:FFFF:FFFF:FFFF:FFFF 로 16비트씩 8그룹으로 묶어 표현한다.  
3. 이동 IP는 무선으로 연결된 호스트에 이동성을 제공한다.  
4. 이동 IP 프로토콜에서 패킷의 중개는 터널링 원리를 사용한다.  
5. IP 터널링은 터널 구간에서 IP 패킷을 전송하려고 IP 프로토콜로 캡슐화한다.  
6. ARP는 MAC 계층에서 필요한 수신 호스트의 MAC 주소를 제공하는 프로토콜이며, 수신 호스트의 IP 주소를 MAC 주소로 변환한다.  
7. RARP는 네트워크 계층에서 필요한 송신 호스트의 IP 주소를 제공하는 프로토콜이며, 송신 호스트의 MAC 주소를 IP 주소로 변환한다.  
8. ICMP는 IP 패킷의 전송 과정에서 발생하는 문제를 송신 호스트에게 통지하려고 사용한다.  
9. IGMP는 멀티캐스팅을 지원하려고 그룹 관리 기능을 제공한다.  


  
