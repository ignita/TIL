# 기타 전송 계층 프로토콜  

## UDP(User Datagram Protocol)  
- 인터넷에서 사용하는 프로토콜 중 구조가 가장 간단  
- 작지만 빠른 전송이 가능  
- 특징  
  - 비연결형 서비스를 제공  
  - 헤더와 전송 데이터에 대한 체크섬 기능을 제공  
  - Best Effort 전달 방식을 지원  
- UDP는 상위 계층에서 받은 데이터를 IP 프로토콜에 전달하지만 전송한 데이터그램이 목적지까지 제대로 도착했는지는 확인하지 않는다.  
- 따라서 TCP보다 신뢰성이 떨어진다.  
- 하지만 프로토콜을 처리하는 기능이 작아 TCP보다 데이터 처리가 빠르다. 그래서 데이터 전송 시간에 민감한 응용 환경에선 유리  

### UDP 헤더  
![UDP 헤더](http://dbscthumb.phinf.naver.net/3578_000_1/20141023224438889_6S6WSGUNU.jpg/ka8_136_i1.jpg?type=w460_fst_n&wm=Y)  
- 체크섬: 수신 호스트가 전송된 데이터의 변경여부를 검사하는 수단  
  - 송신측에서는 전송될 데이터에 대해 체크섬을 계산해 헤더에 저장  
  - 수신측에서는 수신된 데이터에 대해 체크섬을 계산해 헤더에 저장된 체크섬과 비교  
  - 일치할 경우 데이터를 정상적으로 수신, 불일치할 경우 데이터를 폐기  
- 송신 포트: 해당 패킷을 만든 송신자의 포트 번호  
- 수신 포트: 해당 패킷을 수신할 수신자의 포트 번호  
- Length: UDP 헤더와 데이터를 포함한 전체 길이  

### UDP의 데이터 전송  
- 비연결형 서비스를 이용해 데이터그램을 전송  
- Best Effort: 데이터가 수신 호스트에게 도착하게 노력은 하지만 100% 데이터가 모두 도착하는 것은 보장하지 않음.  
- 실시간 스트리밍 영상, 게임, 전화 등에 사용  

#### UDP에서의 데이터그램 분실  
- 전송 과정에서 데이터그램을 분실하는 오류 
- 순서 번호와 유사한 기능을 프로그램 내부에 구현해야함.  

#### UDP에서의 데이터그램 도착 순서 변경  
- 데이터그램의 전송 순서가 뒤바뀌어 수신자에게 도착하는 경우  
- 응용 프로그램 내부에서 데이터 순서 번호 기능이 구현  

## RTP(Real Time Protocol)  
- 인터넷의 멀티미디어 서비스가 실시간으로 다운로드하며 재생되는 형태로 변함  
  - 기존의 TCP는 패킷의 순서와 신뢰성이 지나치게 강조되 패킷의 재전송 기능과 복잡한 흐름 제어 기능으로 인해 실시간 환경에 부적합  
  - UDP는 데이터그램의 순서를 보장하지 못한다는 문제가 있음  
  - 따라서 새로운 실시간 데이터 전송 서비스의 특성을 지원하는 프로토콜이 필요  
  - UDP에 데이터그램 순서 번호 기능을 추가하는 것 = RTP  
- 특징    
  - 불규칙하게 수신되는 데이터 순서 정렬을 위해 타임스탬프 방식을 사용  
  - 프로토콜 동작이 응용 프로그램의 라이브러리 형태로 구현되는 ALF(Application Level Framing) 방식  
  - UDP 수송프로토콜 위에서 실행되며 주로 실시간 서비스를 제공 .
  - RTP는 실시간 통신에 필수적인 시간 정보 및 매체의 동기화 기능 제공 
  - 프로토콜 동작이 응용프로그램의 라이브러리 형태로 구현됨 
	  - Ex) JRTP 라이브러리를 이용한 자바에서 RTP 구현
  - 다른 프로토콜과는 달리 미리 예약된 포트(Well Known Port)를 사용하지 않음
	  - Ex) 게임 WarCraft는 UDP방식으로 6112 포트 지정사용
  - 전달 가능 데이터 포멧이 여러가지임 
	  - 오디오용 PCM, GSM 또는 MP3, 비디오용 MPEG 또는 H.263, H.261 등 표준화된 포맷을 전달, 비표준화된 사적인 오디오/비디오 형식도 전달 가능

### 실시간 요구 사항  

#### 버퍼의 역할   
- 데이터의 송수신 속도간의 차이를 보정  
- 데이터를 임시적으로 저장하기 위한 RAM 영역  

#### 지터(Jitter)  
- 지터: 디지털 신호 파형이 순간적으로 흐트러지는 현상  
- 지터분포: 데이터그램 도착 시간이 일정하지 않고 불규칙적으로 도착하는 정도를 나타낸 것.  

### RTP의 데이터 전송 프로토콜  
- 두 종류의 RTP 릴레이를 지원. 
- 릴레이는 데이터 전송 과정에서 송수신 프로세스가 데이터를 직접 전송할 수 없는 상황이 발생했을 때, 데이터를 중개하는 기능  
- 예) 송수신 프로세스 사이에 방화벽이 설치되거나 데이터 형식이 다를 때, 릴레이가 필요한 처리를 수행해 전송이 가능하도록 지원  

#### 믹서  
- 여러 송신 프로세스로부터 RTP 데이터그램 스트림을 받아서 이들을 적절히 조합해 새로운 데이터그램 스트림을 생성  
- 수신한 데이터의 시간 관계를 적절히 조절하기 위해 데이터그램 스트림에 시간 정보를 제공  

#### 트랜슬레이터  
- 입력된 각 RTP 데이터그램을 하나 이상의 출력용 RTP 데이터그램으로 만들어주는 장치  
- 예) 여러 수신 프로세스 그룹에서 특정 수신 프로세스가 고속의 비디오 신호를 처리할 능력이 없으면 트랜슬레이터가 비디오 신호를 저해상도 신호로 변환해 수신 프로세스가 처리할 수 있도록 도와준다.  

- 스트림은 데이터그램을 연속적으로 전송한다는 의미.  

### RTP 헤더   
![RTP 헤더](http://dbscthumb.phinf.naver.net/3578_000_1/20141023224448785_6HZDE9IJF.jpg/ka8_141_i1.jpg?type=w575_fst_n&wm=Y)  
유니캐스트와 실시간 전송에 사용되는 RTP의 장점은 멀티캐스트 전송도 지원한다는 것이다. 이를 위해 RTP 데이터 형식에는 그룹에서 누가 데이터를 전송했는지를 확인하는 송신 구분자(Source Identifier) 필드가 존재한다. 또한 수신 측에서 지연 버퍼를 사용해 타이밍 관계를 조절할 수 있도록 Timestamp 필드도 있다.
-  Version(버전) : RTP의 버전 번호로, 현재 2로 지정되어 있다.
- Padding(패딩) : 페이로드의 마지막에 패딩 바이트가 존재하는지 여부를 나타낸다. 응용 환경에서 페이로드의 크기가 특정 크기의 배수가 되어야 할 때 사용한다.
- Extension(확장) : 값이 1이면 [그림 10-7]에 표기된 고정 헤더의 마지막에 확장 헤더가 하나 더 이어짐을 의미한다.
- CSRC Count(CSRC 개수) : CSRC 구분자의 개수를 표시한다.
- Marker(표식) : 임의의 표식(Marking)을 위해 이용하므로, 페이로드 유형에 따라 값의 의미가 결정된다. 보통 데이터 스트림의 경계점을 표시하는 데 사용한다. 예를 들어, 비디오 페이로드에서는 프레임 마지막을 표시한다.
- Payload Type(페이로드 유형) : 데이터그램에 포함된 페이로드의 유형을 나타낸다. 예를 들어, JPEG 영상에 대해 표시할 수 있다. 페이로드의 내용은 음성과 영상 등의 형식을 포함하는데, [표 10-1]은 RFC 1890에서 권고한 표준 오디오 · 비디오 인코딩이다.
- Sequence Number(순서 번호) : Timestamp 필드 값이 같은 데이터그램에 대해 패킷 손실이나 순서 변경과 같은 오류를 검출할 수 있도록 한다.
- Timestamp(타임스탬프) : 데이터그램에 포함된 데이터의 생성 시기를 나타낸다. 시간 단위는 페이로드 종류에 영향을 받으며 송신 프로세스의 클록에 의해 발생한다.
- SSRC Identifier(SSRC 구분자) : 세션에서의 소스(Source)를 구분하는 고유 번호로, 랜덤하게 생성되는 32비트 숫자다.

- 고정 헤더의 뒷 부분에는 CSRC Identifier 필드가 여러 개 존재할 수 있으며, 이는 믹서가 제공하는 구분자다.  

### RTP 제어 프로토콜  
- RTCP(RTP Control Protocol)  
- 인터넷을 통한 영상이나 음성의 스트리밍용 프로토콜인 RTP를 제어하기 위한 프로토콜
- 수신자에대한 정보수집 및 수신측 전송율 계산 

## 요약  
1. 비연결형 서비스를 제공하는 UDP는 신뢰성 있는 데이터 전송을 보장하지 않는다.

2. UDP 헤더는 필드가 4개만 정의되어, 빠른 데이터 전송을 지원한다.

3. UDP에는 데이터 순서 번호 기능이 없기 때문에 데이터그램 분실이나 데이터그램 도착 순서 변경 오류가 발생할 수 있다.

4. RTP는 실시간 응용 서비스를 지원하는 프로토콜로, 하위의 UDP를 사용해 구현되었다.

5. 실시간 서비스를 제공하기 위해 고려할 시간 정보 중에는 도착 데이터의 시간 간격을 의미하는 지터 정보가 있다.

6. OSI TP는 OSI에서 규정한 전송 계층 프로토콜이며, 다섯 종류의 서비스 클래스를 지원한다.
